<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 你不知道的JavaScript--作用域 · gaochen</title><meta name="description" content="你不知道的JavaScript--作用域 - gaochen"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="https://github.com/gaochen" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">你不知道的JavaScript--作用域</h1><div class="post-time">Apr 19, 2016</div><div class="post-content"><h3 id="作用域：是一套设计良好的规则，用来存储变量，并且之后可以方便地找到这些变量。"><a href="#作用域：是一套设计良好的规则，用来存储变量，并且之后可以方便地找到这些变量。" class="headerlink" title="作用域：是一套设计良好的规则，用来存储变量，并且之后可以方便地找到这些变量。"></a>作用域：是一套设计良好的规则，用来存储变量，并且之后可以方便地找到这些变量。</h3><p>引擎：从头到尾负责整个JavaScript 程序的编译及执行过程。</p>
<p>编译器：负责语法分析及代码生成等。</p>
<p>作用域：负责收集并维护由所有声明的标识符(变量)组成的一系列查询，并实施一套非常严格的规则，确定当前执行的代码对这些标识符的访问权限。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;  <span class="comment">//这段代码是如何执行的</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>简单来说：变量的赋值操作会执行两个动作，首先编译器会在当前作用域中声明一个变量（如果之前没有声明过），然后在运行时引擎会在作用域中查找该变量，如果能够找到就会对它赋值。</p>
<p>在这个例子中，引擎会为变量a 进行LHS 查询。另外一个查找的类型叫作RHS。</p>
<p>LHS：找到变量的容器本身，从而可以对其赋值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;  <span class="comment">//这里对a的引用则是LHS引用，因为不关心a的值，只是想要为=2这个赋值操作找到一个目标</span></span><br></pre></td></tr></table></figure>
<p>RHS：只简单地查找某个变量的值，不进行赋值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(a);   <span class="comment">//  对a的引用是一个RHS引用，因为这里a并没有赋予任何值，只是找到获取到a的值，</span></span><br><span class="line">                  <span class="comment">//  传递给console.log(...)</span></span><br></pre></td></tr></table></figure>
<p>例子：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> b = a;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c = foo(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">LHS：<span class="number">3</span>处，c=...; a=<span class="number">2</span>(隐式变量分配); b=... ;</span><br><span class="line">RHS：<span class="number">4</span>处，foo(<span class="number">2.</span>..; =a; a...; b...;</span><br></pre></td></tr></table></figure></p>
<p>异常情况：</p>
<p>非严格模式下，当变量还没有声明（在任何作用域中都无法找到该变量），这两种查询的行为是不一样的。</p>
<p>如果是RHS查询，引擎就会抛出ReferenceError异常。</p>
<p>如果是LHS查询，全局作用域中就会隐式的创建一个具有该名称的变量，并将其返还给引擎，前提是程序运行在非“严格模式”下。</p>
<p>如果RHS查询到了变量，但是对这个变量的值进行了不合理的操作，那么引擎会抛出另外一种类型的异常，叫作TypeError。</p>
<p>ReferenceError同作用域判别失败相关，而TypeError则代表作用域判别成功了，但是对结果的操作是非法或不合理的。</p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/04/21/20160421/" class="prev">上一篇</a><a href="/2016/04/12/20160412/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://yoursite.com">gaochen</a>, unless otherwise noted.</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?a36e15d9e2adec9a21fcdd9f686b1ed2";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>