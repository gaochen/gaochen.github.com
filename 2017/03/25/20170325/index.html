<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> ajax通过header传参 · gaochen</title><meta name="description" content="ajax通过header传参 - gaochen"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="https://github.com/gaochen" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">ajax通过header传参</h1><div class="post-time">Mar 25, 2017</div><div class="post-content"><h2 id="header传参"><a href="#header传参" class="headerlink" title="header传参"></a>header传参</h2><p><strong>场景</strong>：</p>
<p>最近为了提高开发效率，决定将活动等模块都交给h5来做，这里面就涉及到用户登录信息等权限问题。</p>
<a id="more"></a>
<p>比如领取优惠券这一操作，就必须在用户已登录的情况才能执行，同时在调用后端接口的时候需要将包含用户登录信息的token一起传递给后端以获取操作权限。</p>
<p>如果操作接口很多，那每个接口都需要token参数，服务端就提出通过header来传递token值。</p>
<p><strong>实现</strong>：</p>
<p>以jQuery为例：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">    type: <span class="string">"GET"</span>,</span><br><span class="line">    url: api,</span><br><span class="line">    dataType: <span class="string">"json"</span>,</span><br><span class="line">    beforeSend: <span class="function"><span class="keyword">function</span>(<span class="params">xhr</span>) </span>&#123;</span><br><span class="line">        xhr.setRequestHeader(<span class="string">"access-token"</span>,GC.Hybrid.accessToken);</span><br><span class="line">        xhr.setRequestHeader(<span class="string">"session-id"</span>,GC.Hybrid.sessionId);</span><br><span class="line">    &#125;,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>如上，首先使用了beforeSend方法，其作用是在发送请求之前调用，并且传入一个XMLHttpRequest作为参数。然后再通过XMLHttpRequest对象提供的setRequestHeader方法就可以设置请求头信息。</p>
<p>说到beforeSend方法，这里还有一个小技巧可以用它提高用户体验：</p>
<p><strong>1. 防止重复提交</strong></p>
<p>用户点击按钮提交时，如果网络不好，或者重复点击，就会出现多次提交的情况，可能会导致脏数据的产生。为了避免这种情况，就可以在beforeSend方法中把提交按钮禁用掉，等到ajax请求完成之后再将按钮恢复到可用状态。</p>
<p><strong>2. 增加loading效果</strong></p>
<p>在ajax请求耗时较长的情况下，可以在beforeSend方法中添加loading效果，提高用户体验性。</p>
<h2 id="回顾其他传参方式"><a href="#回顾其他传参方式" class="headerlink" title="回顾其他传参方式"></a>回顾其他传参方式</h2><p><strong>1. path</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/user/123</span><br></pre></td></tr></table></figure>
<p><strong>2. query</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /api/search_user?foo1=bar1&amp;foo2=bar2</span><br><span class="line"></span><br><span class="line">data:&#123;foo1:&quot;bar1&quot;,foo2:&quot;bar2&quot;&#125; // 或者通过data参数</span><br></pre></td></tr></table></figure></p>
<p><strong>3. body</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">    type: &quot;POST&quot;,</span><br><span class="line">    url: api,</span><br><span class="line">    data:JSON.stringify(&#123;&quot;phoneNumber&quot;:phone, &quot;name&quot;: name&#125;),</span><br><span class="line">    dataType: &quot;json&quot;,</span><br><span class="line">    contentType: &quot;application/json&quot;,</span><br><span class="line">    beforeSend: function(request) &#123;</span><br><span class="line">        request.setRequestHeader(&quot;access-token&quot;,GC.Hybrid.accessToken);</span><br><span class="line">        request.setRequestHeader(&quot;session-id&quot;,GC.Hybrid.sessionId);</span><br><span class="line">    &#125;,</span><br><span class="line">    success: function(res) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
</div></article></div></section><footer><div class="paginator"><a href="/2017/03/29/20170329/" class="prev">PREV</a><a href="/2017/03/09/20170309/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2017 <a href="http://yoursite.com">gaochen</a>, unless otherwise noted.</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?a36e15d9e2adec9a21fcdd9f686b1ed2";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>